# Programming, processes, &c.

## Secondary storage

### Hard drives
- Programs use disk as source & destination of processing
- Seek time: 7ms
- Spin: 7200-15000 rm
- Transfer rate
    - Disk-to-buffer: 70MB/s (sata)
    - Buffer-to-computer: 300 MB/s
- Mean time between failures
    - 600k hours
- 1TB capacity < $100
- Improvements in hard disk capacity
    - 2002 - 128GB addressing space barrier (28 bits)
        - Old IDE/ATA interface: 28 bit addressing
        - 2^37 = 128GB
    - 2003 - serial ATA introduced
    - 2005 - 500GB hard drives
    - 2008 - 1TB hard drives

### Since caches have limited size, cache mgmt is essential

### Large portion of the OS code is dedicated for I/O mgmt
- Typical system comprises CPUs & multiple device controllers connected through a bus
- High-end systems use switch-based architecture
    - Components talk to each other concurrently
    - No competition for cycles on the bus

### Device controllers move data between local buffer storage & peripheral devices
1. Driver loads appropriate registers in controller
2. Controller examines contents to determine action to take
3. Controller transfers data from device to local buffer
4. Once transfer is complete, controller informs driver via interrupt
5. Driver returns control to OS

### USB (Universal Serial Bus)
- Attach slow I/O devices to computer
- Uses small 4-wire connector (two electrical, two data)
- Centralized bus
    - Root device polls I/O devices every 1ms

### Because of all these buses, OS must know which devices are connected & how to configure them
- Intel, Microsoft developed plug-&-play
    - Mac already impelemented a similar feature

## Performance

### How to improve performance?
- Determine bottlenecks
    - Replicate
    - Improve

### Single processor systems
- System may have special purpose processors
    - Incapable of running user processes
    - Limited instruction set
- Disk controller micro-processor
    - Implements disk queue & scheduling algorithms
- Keyboard microprocessors
    - Convert keystrokes into CPU-bound codes

### Multiprocessor systems
- Processors share bus, may share clock, memory, & peripheral devices
- Advantages
    - Increased bandwidth
    - Reliable
    - Less power than producing higher clocking single core CPUs
- Asymmetric
    - Controller manages system
    - Workers rely on controller for instructions
- Symmetric
    - Processors are peers & perform all OS tasks
    - Have own set of registers & local cache
        - Share physical memory

### Multiprogramming
- Organizes jobs so that CPU always has one to execute
- Single program cannot keep CPU & I/O devices busy at all times
- User frequently runs multiple programs
- When job needs to wait, CPU switches to another job
- Utilizes resources effectively
- Requires many jobs to be held simultaneously in memory

### Time sharing
- Logical extension of multiprogramming
- CPU switches jobs frequently, users can interact w programs
- Time shared OS allows many users to use computer simultaneously
- Each action in a time shared OS tends to be short
    - CPU time needed for each user is small

### System calls
- Request OS for service
- Causes normal CPU processing to be interrupted
- Control given to OS
- Types
    - Process control
    - File manipulation
    - Device manipulation
    - Info maintenance
    - Comms
    - Protection

### Mode bit
- Allows to distinguish between task executed on behalf of OS/user
- Kernel: 0, user: 1
- MS-DOS/Intel 8088 had no mode bit
    - No dual-mode
    - Programs can wipe out OS by writing over it
- Most modern OS take advantage of dual mode & provide greater protection for OS

### Main memory
- Generally only large storage device CPU deals with
- Execute a program -> map it to absolute addresses & load it into memory
- Execution involves accesses to instructions & data from memory by generating absolute addresses
- When program terminates, space is terminated

## Program constructs

### Important program constructs
- Communication, concurreny, & async operation
- Challenges & implications
    - Improper handling can lead to failures for no apparent reason
    - Run for weeks or months
    - Avoid resource leaks
    - Cope with outrageously malicious input
    - Recover from errors

### Concurrency
- Occurs at hardware level because devices operate at same time
- Interrupt: electrical signal generated by peripheral device to set hardware flag on CPU
- Interrupt detection is part of instruction cycle
